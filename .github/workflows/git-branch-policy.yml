name: ğŸ›¡ï¸ Git Branch Policy Enforcement

on:
  pull_request:
    types: [opened, reopened, synchronize]
    branches:
      - main
      - develop

jobs:
  prevent-feature-to-main:
    runs-on: ubuntu-latest
    if: github.base_ref == 'main' && startsWith(github.head_ref, 'feature/')
    steps:
      - name: âŒ Block feature/* from merging into main
        run: |
          echo "âŒ KhÃ´ng Ä‘Æ°á»£c merge trá»±c tiáº¿p tá»« feature/* vÃ o main."
          echo "ğŸ‘‰ Vui lÃ²ng merge vÃ o develop thay vÃ¬ main."
          exit 1

  check-branch-name:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ§ª Check if branch name follows convention
        run: |
          BRANCH_NAME="${{ github.head_ref }}"

          echo "ğŸ” Kiá»ƒm tra nhÃ¡nh: $BRANCH_NAME"

          # Regex: Loáº¡i nhÃ¡nh + module + tÃªn tÃ­nh nÄƒng (pháº£i cÃ³ Ã­t nháº¥t 2 pháº§n sau tiá»n tá»‘)
          if [[ ! "$BRANCH_NAME" =~ ^(feature|bugfix|hotfix|refactor)/[a-z0-9_-]+(/.+)?$ ]]; then
            echo "âŒ TÃªn nhÃ¡nh khÃ´ng há»£p lá»‡!"
            echo "ğŸ‘‰ Äáº·t tÃªn theo dáº¡ng: feature/module/feature-name"
            echo "   VÃ­ dá»¥: feature/account/user-crud"
            exit 1
          else
            echo "âœ… TÃªn nhÃ¡nh há»£p lá»‡."
          fi
