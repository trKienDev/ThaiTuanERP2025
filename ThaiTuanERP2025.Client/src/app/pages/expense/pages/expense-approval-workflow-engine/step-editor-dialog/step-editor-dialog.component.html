<!-- step-editor-dialog.component.html -->
<h3>Thêm / Sửa khối duyệt</h3>

<form [formGroup]="form" (ngSubmit)="save()">
      <div>
            <label>Tên <span class="text-red-600">*</span></label>
            <input matInput formControlName="title" placeholder="Duyệt: Quản lý trực tiếp" />
      </div>

      <div>
            <label>Người duyệt <span class="text-red-600">*</span></label>
            <mat-form-field appearance="outline" class="width-100pt">
                  <mat-chip-grid #chipGrid>
                        <mat-chip-row *ngFor="let u of selectedApprovers" (removed)="removeApprover(u.id)">
                              {{ u.fullName }} ({{ u.username }}) - {{ u.position }}
                              <button matChipRemove aria-label="remove"><mat-icon>close</mat-icon></button>
                        </mat-chip-row>
                        <input placeholder="Tìm theo tên, username, chức vụ" [matChipInputFor]="chipGrid" [matAutocomplete]="auto" [formControl]="approverSearchCtrl" />
                  </mat-chip-grid>

                  <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectApprover($event.option.value)">
                        <mat-option *ngFor="let u of filteredUsers" [value]="u">
                              {{ u.fullName }} ({{ u.username }}) - {{ u.position }}
                        </mat-option>
                  </mat-autocomplete>
            </mat-form-field>
            <div class="text-sm text-red-600" *ngIf="form.get('approverIds')?.touched && form.get('approverIds')?.invalid"> Bắt buộc chọn ít nhất 1 người duyệt. </div>
      </div>

      <div>
            <label>Luồng duyệt <span class="text-red-600">*</span></label>
            <select matNativeControl formControlName="flowType">
                  <option value="Any">Chỉ cần 1 người duyệt</option>
                  <option value="Sequential">Lần lượt</option>
                  <option value="All">Tất cả cùng duyệt</option>
            </select>
      </div>

      <div>
            <label>SLA (giờ)</label>
            <input matInput type="number" min="0" step="1" formControlName="slaHours" (keydown)="allowOnlyNumberKeys($event)" placeholder="Mặc định 8">
      </div>

      <div class="flex justify-end">
            <button type="button" mat-button (click)="cancel()">Hủy</button>
            <button type="submit" mat-raised-button color="primary">Lưu</button>
      </div>
</form>
