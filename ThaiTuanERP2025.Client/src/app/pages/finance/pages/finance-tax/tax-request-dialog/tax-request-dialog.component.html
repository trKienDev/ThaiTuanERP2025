<h2 mat-dialog-title>Chính sách thuế mới</h2>

<div mat-dialog-content [formGroup]="form">
      <mat-form-field appearance="outline" class="w-full">
            <mat-label>Tên chính sách thuế</mat-label>
            <input matInput formControlName="policyName" placeholder="VD: VAT 10%">
            <mat-error *ngIf="taxRequestForm.policyName.hasError('required')">Bắt buộc</mat-error>
            <mat-error *ngIf="taxRequestForm.policyName.hasError('maxlength')">Tối đa 200 ký tự</mat-error>
            <mat-error *ngIf="taxRequestForm.policyName.hasError('nameTaken')">Tên chính sách đã tồn tại</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
            <mat-label>Mức thuế</mat-label>
            <input matInput type="number" formControlName="rate" step="0.01" placeholder="0.1 = 10%">
            <mat-hint>Nhập 0..1 (ví dụ 0.1 = 10%)</mat-hint>
            <mat-error *ngIf="taxRequestForm.rate.hasError('required')">Bắt buộc</mat-error>
            <mat-error *ngIf="taxRequestForm.rate.hasError('min') || taxRequestForm.rate.hasError('max')">Giá trị từ 0 đến 1</mat-error>
      </mat-form-field>

      <div class="form-group">
            <label for="postingLedgerAccountId">Tài khoản hạch toán</label>

            <input id="ledgerAccountSearch" type="text" [formControl]="ledgerAccountSearchCtrl" 
                  [matAutocomplete]="ledgerAccountAuto" placeholder="Tìm tài khoản hạch toán"/>
            <mat-autocomplete #ledgerAccountAuto="matAutocomplete" (optionSelected)="onLedgerAccountSelected($event)">
                  <mat-option *ngIf="ledgerAccountSearching" disabled>Đang tìm...</mat-option>
                  <ng-container *ngIf="!ledgerAccountSearching">
                        <mat-option *ngFor="let acc of ledgerAccountOptions" [value]="acc">
                              {{ acc.number }} - {{ acc.name }}
                        </mat-option>
                        <mat-option *ngIf="!ledgerAccountOptions.length" disabled>Không có kết quả</mat-option>
                  </ng-container>                       
            </mat-autocomplete>

            <!-- input ẩn (hoặc readonly) để giữ GUID gửi lên server -->
            <input type="text" formControlName="postingLedgerAccountId" hidden />
            <div class="error" *ngIf="taxRequestForm.postingLedgerAccountId.hasError('required')">Bắt buộc</div>
      </div>

      <mat-form-field appearance="outline" class="w-full">
            <mat-label>Mô tả</mat-label>
            <textarea matInput formControlName="description" rows="3"></textarea>
      </mat-form-field>

      <mat-checkbox formControlName="isActive">Kích hoạt</mat-checkbox>

      <div *ngIf="errorMessages.length" class="mt-2">
            <div *ngFor="let msg of errorMessages" class="text-red-600 text-sm">• {{ msg }}</div>
      </div>
</div>

<div mat-dialog-actions align="end">
      <button mat-button (click)="cancel()" [disabled]="saving">Hủy</button>
      <button mat-raised-button color="primary" (click)="submit()" [disabled]="saving">
            {{ saving ? 'Đang lưu...' : 'Lưu' }}
      </button>
</div>