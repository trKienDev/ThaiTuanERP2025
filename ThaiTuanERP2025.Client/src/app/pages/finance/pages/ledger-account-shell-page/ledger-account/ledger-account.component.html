<div class="la">
      <!-- Action bar -->
      <div class="la__actions">
            <button class="btn btn-primary" (click)="openCreate()">+ Tài khoản kế toán</button>
            <div class="spacer"></div>
            <input class="search" [formControl]="searchCtl" placeholder="Tìm theo tên tài khoản..." />
      </div>

      <!-- Header table -->
      <div class="la__table panel">
            <div class="table__header">
                  <div class="col col-number">SỐ HIỆU</div>
                  <div class="col col-name">TÊN TÀI KHOẢN</div>
                  <div class="col col-type">LOẠI TÀI KHOẢN</div>
                  <div class="col col-balance">TÍNH CHẤT</div>
                  <div class="col col-desc">MÔ TẢ</div>
                  <div class="col col-status">TRẠNG THÁI</div>
                  <div class="col col-actions"></div>
            </div>

            <!-- Body: virtual scroll -->
            <cdk-virtual-scroll-viewport class="table__viewport" [itemSize]="44">
                  <div *cdkVirtualFor="let row of filteredRows(); trackBy: trackById" class="table__row">
                        <div class="col col-number mono">{{ row.number }}</div>

                        <div class="col col-name">
                              <div class="name" [style.padding-left.px]="row.level * 16">
                                    <span class="indent-dot" *ngIf="row.level > 0">•</span>
                                    <span class="name__text">{{ row.name }}</span>
                                    <span class="children" *ngIf="row.childrenCount > 0">({{ row.childrenCount }})</span>
                              </div>
                        </div>

                        <div class="col col-type">{{ row.typeName }}</div>
                        <div class="col col-balance">{{ balanceLabel(row.balanceType) }}</div>
                        <div class="col col-desc">{{ row.description }}</div>

                        <div class="col col-status">
                              <label class="switch">
                                    <input type="checkbox" [checked]="row.isActive" (change)="toggleActive(row, $event)" />
                                    <span class="slider"></span>
                              </label>
                        </div>

                        <div class="col col-actions">
                              <button class="btn btn-link" (click)="openEdit(row)">Sửa</button>
                              <button class="btn btn-link danger" (click)="delete(row)">Xóa</button>
                        </div>
                  </div>
            </cdk-virtual-scroll-viewport>
      </div>

      <!-- Drawer -->
      <div class="drawer" [class.open]="drawerOpen()">
            <div class="drawer__header">
                  <h3 class="drawer__title">{{ isEditMode() ? 'Sửa tài khoản' : 'Tạo tài khoản' }}</h3>
                  <button class="btn btn-icon" (click)="closeDrawer()">✕</button>
            </div>

            <form class="drawer__body" (ngSubmit)="submit()">
                  <div class="grid">
                        <label>Số hiệu<span class="req">*</span>
                              <input [(ngModel)]="form().number" name="number" required />
                        </label>

                        <label>Tên tài khoản<span class="req">*</span>
                              <input [(ngModel)]="form().name" name="name" required />
                        </label>

                        <label>Loại tài khoản<span class="req">*</span>
                              <select [(ngModel)]="form().ledgerAccountTypeId" name="typeId" required>
                                    <option *ngFor="let t of ledgerAccountTypes()" [ngValue]="t.id">{{ t.name }}</option>
                              </select>
                        </label>

                        <label>Tính chất
                              <select [(ngModel)]="form().ledgerAccountBalanceType" name="balanceType">
                                    <option [ngValue]="1">Dư Nợ</option>
                                    <option [ngValue]="2">Dư Có</option>
                                    <option [ngValue]="3">Lưỡng tính</option>
                                    <option [ngValue]="4">Không xác định</option>
                              </select>
                        </label>

                        <label class="col-2">Mô tả
                              <input [(ngModel)]="form().description" name="description" />
                        </label>

                        <label class="col-2">Tài khoản cha (tuỳ chọn)
                              <input [formControl]="parentKeywordCtl" placeholder="Nhập số hiệu hoặc tên để tìm..." />
                              <div class="suggestions" *ngIf="parentSuggestions().length > 0">
                                    <div class="suggest-item" *ngFor="let s of parentSuggestions()" (click)="pickParent(s.id)">
                                          <span class="mono">{{ s.number }}</span>
                                          <span class="sep">–</span>
                                          <span [style.padding-left.px]="s.level * 12">{{ s.name }}</span>
                                    </div>
                              </div>
                              <div class="picked" *ngIf="form().parentLedgerAccountId">
                                    Đã chọn: <code>{{ form().parentLedgerAccountId }}</code>
                                    <button type="button" class="btn btn-link" (click)="clearParent()">Bỏ chọn</button>
                              </div>
                        </label>

                        <div class="col-2">
                              <label class="switch">
                                    <input type="checkbox" [(ngModel)]="form().isActive" name="isActive" />
                                    <span class="slider"></span>
                              </label>
                              <span class="switch-label">Kích hoạt</span>
                        </div>
                  </div>

                  <div class="drawer__footer">
                        <button type="button" class="btn" (click)="closeDrawer()">Hủy</button>
                        <button type="submit" class="btn btn-primary">{{ isEditMode() ? 'Cập nhật' : 'Lưu' }}</button>
                  </div>
            </form>
      </div>

      <!-- Drawer overlay -->
      <div class="drawer__backdrop" [class.open]="drawerOpen()" (click)="closeDrawer()"></div></div>
