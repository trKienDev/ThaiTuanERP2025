<ng-container *ngIf="loading(); else contentTpl">
      <kit-loading-spinner></kit-loading-spinner>
</ng-container>

<!-- 2) Content -->
<ng-template #contentTpl>
      <ng-container *ngIf="paymentDetail() as detail; else errorTpl">
            <form class="outgoing-payment-form" [formGroup]="form" autocomplete="off" (ngSubmit)="submit()">
                  <div class="request-heading display-flex justify-content-between align-items-center">
                        <div class="page-title">
                              <h3 class="icon">üí∑</h3>
                              <h3 class="title">Ghi nh·∫≠n kho·∫£n ti·ªÅn ra</h3>
                              <h3 class="title payment-name">{{ detail.name }}</h3>
                        </div>
                        <div class="process-button-container display-flex gap-10px">
                              <button type="button" class="button cancel-button" [disabled]="loading()">H·ªßy</button>
                              <kit-spinner-button type="submit" cssClass="save-button" [loading]="submitting" [disabled]="isBusy || form.invalid" text="T·∫°o kho·∫£n chi" loadingText="ƒêang x·ª≠ l√Ω‚Ä¶"></kit-spinner-button>
                        </div>
                  </div>

                  <div class="request-body margin-top-20px">
                        <div class="form-row">
                              <div class="form-input">
                                    <input type="text" formControlName="name" required />
                                    <label for="name">T√™n kho·∫£n ti·ªÅn ra <span style="color: red">*</span></label>
                                    <div class="form-input-error" *ngIf="submitted && form.get('name')?.invalid">
                                          <small>Vui l√≤ng nh·∫≠p t√™n kho·∫£n ti·ªÅn ra</small>
                                    </div>
                              </div>
                        </div>
                        <div class="form-row display-flex align-items-center gap-20px">
                              <label class="form-label" for="name" style="width: 8%;">T√†i kho·∫£n ti·ªÅn ra <span style="color: red;">*</span></label>
                              <kit-dropdown [options]="(OBAccountOptions | async) ?? []" [placeholder]="'Ch·ªçn t√†i kho·∫£n ti·ªÅn ra'" style="width: 100%;" (selectionChange)="onOBAccountSelected($event)"></kit-dropdown>
                        </div>
                        <div class="form-row">
                              <label class="form-label" for="payment-bank">T√†i kho·∫£n th·ª• h∆∞·ªüng: </label>
                              <div class="receiver-payment display-flex gap-10px margin-top-20px">
                                    <div class="form-input flex-1">
                                          <input class="" type="text" formControlName="bankName" autocomplete="on" required/>
                                          <label for="bank-name">T√™n ng√¢n h√†ng <span style="color: red;">  *</span></label>
                                          <div class="form-input-error" *ngIf="submitted && form.get('bankName')?.invalid">
                                                <small>Vui l√≤ng nh·∫≠p t√™n ng√¢n h√†ng</small>
                                          </div>
                                    </div>
                                    <div class="form-input flex-1">
                                          <input class="" type="text" formControlName="accountNumber" autocomplete="on" required/>
                                          <label for="bank-account">S·ªë t√†i kho·∫£n <span style="color: red;">  *</span></label>
                                          <div class="form-input-error" *ngIf="submitted && form.get('accountNumber')?.invalid">
                                                <small>Vui l√≤ng nh·∫≠p s·ªë t√†i kho·∫£n</small>
                                          </div>
                                    </div>
                                    <div class="form-input flex-1">
                                          <input class="" type="text" formControlName="beneficiaryName" autocomplete="on" required/>
                                          <label for="beneficiary-name">T√™n ng∆∞·ªùi th·ª• h∆∞·ªüng <span style="color: red;">  *</span></label>
                                          <div class="form-input-error" *ngIf="submitted && form.get('beneficiaryName')?.invalid">
                                                <small>Vui l√≤ng nh·∫≠p t√™n ng∆∞·ªùi th·ª• h∆∞·ªüng</small>
                                          </div>
                                    </div>
                              </div>
                        </div>
                        <div class="form-row display-flex gap-10px">
                              <div class="form-column flex-1">
                                    <label class="form-label" for="name">S·ªë ti·ªÅn c√¥ng ty c·∫ßn tr·∫£ üîí</label>
                                    <input class="dark dark-alert user-select-none margin-top-10px" [value]="paymentDetail()?.totalWithTax | number:'1.0-2'" disabled />
                              </div>
                              <div class="form-column flex-1">
                                    <label class="form-label" for="name">S·ªë ti·ªÅn ƒë√£ t·∫°o l·ªánh üîí</label>
                                    <input class="dark dark-alert user-select-none margin-top-10px" [value]="paymentDetail()?.outgoingAmountPaid | number:'1.0-2'" disabled />
                              </div>
                              <div class="form-column flex-1">
                                    <label class="form-label" for="name">S·ªë ti·ªÅn ch·ªù t·∫°o l·ªánh üîí</label>
                                    <input class="dark dark-alert user-select-none margin-top-10px" [value]="paymentDetail()?.remainingOutgoingAmount | number:'1.0-2'" disabled />
                              </div>
                              <div class="form-column flex-1">
                                    <label class="form-label" for="name">S·ªë ti·ªÅn kho·∫£n ti·ªÅn ra <span style="color: red;">  *</span></label>
                                    <input class="margin-top-10px" placeholder="Nh·∫≠p s·ªë ti·ªÅn kho·∫£n ti·ªÅn ra" type="text" inputmode="decimal" appMoney [appMoneyDecimals]="0" formControlName="outgoingAmount" />
                                    <div class="form-input-error" *ngIf="submitted && form.get('outgoingAmount')?.invalid">
                                          <small>Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn kho·∫£n ti·ªÅn ra</small>
                                    </div>
                              </div>
                        </div>
                        <div class="form-row">
                              <label class="form-label" for="category-table">H·∫°ng m·ª•c</label>
                              <table class="table table-center-text margin-top-10px">
                                    <thead>
                                          <tr>
                                                <th style="width: 1%;">#</th>
                                                <th>H·∫°ng m·ª•c</th>
                                                <th class="head-quanity" style="width: 7%;">S·ªë l∆∞·ª£ng</th>
                                                <th>ƒê∆°n gi√°</th>
                                                <th>Th√†nh ti·ªÅn</th>
                                                <th class="head-tax" style="width: 6%;">Thu·∫ø</th>
                                                <th>S·ªë ti·ªÅn thu·∫ø</th>
                                                <th>S·ªë ti·ªÅn c√≥ thu·∫ø</th>
                                                <th class="head-extension">Ng√¢n s√°ch</th>
                                                <th class="head-invoice">H√≥a ƒë∆°n</th>
                                          </tr>
                                    </thead>
                                    <tbody>
                                          <tr *ngFor="let item of paymentDetail()?.items; let i = index">
                                                <td>{{ i + 1 }}</td>
                                                <td class="item-name">{{ item.itemName }}</td>
                                                <td class="item-quanity">{{ item.quantity | number:'1.0-0' }}</td>
                                                <td class="item-unit-price">{{ item.unitPrice | number:'1.0-0' }} VNƒê</td>
                                                <td class="item-amount">{{ item.amount | number:'1.0-0' }} VNƒê</td>
                                                <td class="item-tax">{{ (item.taxRate * 100) | number:'1.0-0' }}%</td>
                                                <td class="item-tax-amount">{{ item.taxAmount | number:'1.0-0' }} VNƒê</td>
                                                <td class="item-total-with-tax">{{ item.totalWithTax | number:'1.0-0' }} VNƒê</td>
                                                <td class="item-budget-code">{{ item.budgetCode?.code}} - {{ item.budgetCode?.name }}</td>
                                                <td class="item-invoice">
                                                      <!-- <button type="button" class="button" [ngClass]="item.invoice ? 'default-button' : 'cancel-button'">
                                                            {{ item.invoice ? 'Xem h√≥a ƒë∆°n' : 'Kh√¥ng h√≥a ƒë∆°n' }}
                                                      </button> -->
                                                </td>
                                          </tr>
                                    </tbody>
                                    <tfoot *ngIf="paymentDetail()?.items?.length">
                                          <tr class="total-row">
                                                <td colspan="4" class=""><strong>T·ªïng</strong></td>
                                                <td>{{ paymentDetail()?.totalAmount | number:'1.0-0' }} VNƒê</td>
                                                <td></td>
                                                <td>{{ paymentDetail()?.totalTax | number:'1.0-0' }} VNƒê</td>
                                                <td>{{ paymentDetail()?.totalWithTax | number:'1.0-0' }} VNƒê</td>
                                                <td colspan="4"></td>
                                          </tr>
                                    </tfoot>
                              </table>
                        </div>
                        <div class="form-row display-flex gap-10px">
                              <div class="form-column flex-1">
                                    <label class="form-label" for="name">Ng√†y t·∫°o thanh to√°n üîí</label>
                                    <input class="dark dark-alert user-select-none margin-top-10px" [value]="paymentDetail()?.createdAt | date:'dd/MM/yyyy'" disabled />
                              </div>
                              <div class="form-column flex-1">
                                    <label class="form-label" for="name">H·∫°n thanh to√°n <span style="color: red;">  *</span></label>
                                    <input class="due-date margin-top-10px" formControlName="dueDate" matInput [matDatepicker]="picker" placeholder="ch·ªçn ng√†y/th√°ng/nƒÉm"
                                    (focus)="picker.open()" (click)="picker.open()" (keydown.enter)="picker.open()" (keydown.arrowDown)="picker.open()" required/>
                                    <mat-datepicker #picker panelClass="kit-datepicker"></mat-datepicker>
                              </div>
                        </div>
                        <div class="form-row">
                              <label class="form-label" for="name">Ng∆∞·ªùi theo d√µi</label>
                        </div>
                        <div class="form-row">
                              <label class="form-label" for="name">M√¥ t·∫£</label>
                              <textarea class="margin-top-10px" formControlName="description" placeholder="Tr√¨nh b√†y n·ªôi dung ·ªü ƒë√¢y" noSpellcheck></textarea>
                        </div>
                        <div class="form-row">
                              <span>T·ªáp ƒë√≠nh kho·∫£n ti·ªÅn ra</span>
                              <kit-file-uploader [meta]="uploadMeta" [(uploads)]="uploads"></kit-file-uploader>
                        </div>
                        <kit-overlay-spinner [show]="isBusy" [message]="submitting ? 'ƒêang g·ª≠i ph√™ duy·ªát‚Ä¶' : 'ƒêang t·∫£i t·ªáp l√™n‚Ä¶'"></kit-overlay-spinner>
                  </div>
            </form>
      </ng-container>
</ng-template>

<!-- 3) Error -->
<ng-template #errorTpl>
      <kit-404-page title="‚õî Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu thanh to√°n" variant="404"></kit-404-page>
</ng-template>