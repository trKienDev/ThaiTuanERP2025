<ng-container *ngIf="loading(); else contentTpl">
      <kit-loading-spinner></kit-loading-spinner>
</ng-container>

<!-- 2) Content -->
<ng-template #contentTpl>
      <ng-container *ngIf="paymentDetail() as detail; else errorTpl">
            <form class="outgoing-payment-form" [formGroup]="form" autocomplete="off" (ngSubmit)="submit()">
                  <div class="request-heading display-flex justify-content-between align-items-center">
                        <div class="page-title">
                              <h3 class="icon">üí∑</h3>
                              <h3 class="title">Ghi nh·∫≠n kho·∫£n kho·∫£n chi</h3>
                              <h3 class="title payment-name" (click)="openExpensePaymentDetailDialog(paymentDetail()?.id!)">{{ detail.name }}</h3>
                        </div>
                        <div class="process-button-container display-flex gap-10px">
                              <button type="button" class="button cancel-button" [disabled]="loading()">H·ªßy</button>
                              <kit-spinner-button type="submit" cssClass="save-button" [loading]="submitting" [disabled]="isBusy" text="T·∫°o kho·∫£n chi" loadingText="ƒêang x·ª≠ l√Ω‚Ä¶"></kit-spinner-button>
                        </div>
                  </div>

                  <div class="request-body margin-top-20px">
                        <div class="form-row">
                              <div class="form-input">
                                    <input class="" type="text" formControlName="name" autocomplete="on" required
                                    [class.is-invalid]="showErrors && form.get('name')?.invalid"  [attr.aria-invalid]="showErrors && form.get('name')?.invalid ? 'true' : null"/>
                                    <label for="name">T√™n t√†i kho·∫£n chi<span style="color: red">  *</span></label>
                                    <div class="form-input-error" *ngIf="showErrors && form.get('name')?.invalid">
                                          <small>Vui l√≤ng nh·∫≠p t√™n kho·∫£n chi</small>
                                    </div>
                              </div>
                        </div>
                        <div class="form-row display-flex gap-10px">
                              <div class="flex-1">
                                    <kit-dropdown  [options]="(outgoingBankOptions | async) ?? []" [placeholder]="'Ch·ªçn t√†i kho·∫£n kho·∫£n chi'" [required]="true" [enableFilter]="false"
                                    [invalid]="showErrors && (form.get('outgoingBankAccountId')?.invalid ?? false)" formControlName="outgoingBankAccountId"></kit-dropdown>
                                    <div class="form-input-error" *ngIf="showErrors && form.get('outgoingBankAccountId')?.invalid">
                                          <small>Vui l√≤ng ch·ªçn t√†i kho·∫£n kho·∫£n chi</small>
                                    </div>
                              </div>
                              <div class="form-input flex-1">
                                    <input type="text" [value]="paymentDetail()?.supplierName" disabled>
                                    <label for="name">C√° nh√¢n th·ª• h∆∞·ªüng kho·∫£n chi <span style="color: red">*</span></label>
                              </div>
                        </div>
                        <div class="form-row">
                              <label class="label" for="payment-bank">T√†i kho·∫£n th·ª• h∆∞·ªüng</label>
                              <div class="receiver-payment display-flex gap-10px margin-top-20px">
                                    <div class="form-input flex-1">
                                          <input class="" type="text" formControlName="bankName" autocomplete="on" required/>
                                          <label for="bank-name">T√™n ng√¢n h√†ng <span style="color: red;">  *</span></label>
                                          <div class="form-input-error" *ngIf="submitted && form.get('bankName')?.invalid">
                                                <small>Vui l√≤ng nh·∫≠p t√™n ng√¢n h√†ng</small>
                                          </div>
                                    </div>
                                    <div class="form-input flex-1">
                                          <input class="" type="text" formControlName="accountNumber" autocomplete="on" required/>
                                          <label for="bank-account">S·ªë t√†i kho·∫£n <span style="color: red;">  *</span></label>
                                          <div class="form-input-error" *ngIf="submitted && form.get('accountNumber')?.invalid">
                                                <small>Vui l√≤ng nh·∫≠p s·ªë t√†i kho·∫£n</small>
                                          </div>
                                    </div>
                                    <div class="form-input flex-1">
                                          <input class="" type="text" formControlName="beneficiaryName" autocomplete="on" required/>
                                          <label for="beneficiary-name">T√™n ng∆∞·ªùi th·ª• h∆∞·ªüng <span style="color: red;">  *</span></label>
                                          <div class="form-input-error" *ngIf="submitted && form.get('beneficiaryName')?.invalid">
                                                <small>Vui l√≤ng nh·∫≠p t√™n ng∆∞·ªùi th·ª• h∆∞·ªüng</small>
                                          </div>
                                    </div>
                              </div>
                        </div>
                        <div class="form-row display-flex gap-10px">
                              <div class="form-input flex-1">
                                    <input class="dark dark-alert user-select-none" [value]="paymentDetail()?.totalWithTax | number:'1.0-2'" disabled />
                                    <label for="name">S·ªë ti·ªÅn c√¥ng ty c·∫ßn tr·∫£ üîí</label>
                              </div>
                              <div class="form-input flex-1">
                                    <input class="dark dark-alert user-select-none" [value]="paymentDetail()?.outgoingAmountPaid | number:'1.0-2'" disabled />
                                    <label class="" for="name">S·ªë ti·ªÅn ƒë√£ t·∫°o l·ªánh üîí</label>
                              </div>
                              <div class="form-input flex-1">
                                    <input class="dark dark-alert user-select-none" [value]="paymentDetail()?.remainingOutgoingAmount | number:'1.0-2'" disabled />
                                    <label for="name">S·ªë ti·ªÅn ch·ªù t·∫°o l·ªánh üîí</label>
                              </div>
                              <div class="form-input flex-1">
                                    <input type="text" inputmode="decimal" appMoney [appMoneyDecimals]="0" formControlName="outgoingAmount" autocomplete="on" required
                                    [class.is-invalid]="showErrors && form.get('outgoingAmount')?.invalid"  [attr.aria-invalid]="showErrors && form.get('outgoingAmount')?.invalid ? 'true' : null"/>
                                    <div class="form-input-error" *ngIf="submitted && form.get('outgoingAmount')?.invalid">
                                          <small>Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn kho·∫£n chia</small>
                                    </div>
                                    <label for="outgoing-amount">S·ªë ti·ªÅn kho·∫£n chi <span style="color: red;">  *</span></label>
                              </div>
                        </div>
                        <div class="form-row">
                              <label class="label" for="category-table">H·∫°ng m·ª•c</label>
                              <expense-payment-items-table
                                    [items]="paymentDetail()?.items ?? []"
                                    [totalAmount]="paymentDetail()?.totalAmount"
                                    [totalTax]="paymentDetail()?.totalTax"
                                    [totalWithTax]="paymentDetail()?.totalWithTax"
                                    [showInvoiceButton]="true"
                                    (viewInvoice)="previewInvoice($event)">
                              </expense-payment-items-table>
                        </div>
                        <div class="form-row display-flex gap-10px">
                              <div class="form-column flex-1">
                                    <label class="label" for="name">Ng√†y t·∫°o thanh to√°n üîí</label>
                                    <input class="dark dark-alert user-select-none margin-top-10px" [value]="paymentDetail()?.createdAt | date:'dd/MM/yyyy'" disabled />
                              </div>
                              <div class="form-column flex-1">
                                    <label class="label" for="name">H·∫°n thanh to√°n <span style="color: red;">  *</span></label>
                                    <input class="due-date margin-top-10px" formControlName="dueAt" matInput [matDatepicker]="picker" placeholder="ch·ªçn ng√†y/th√°ng/nƒÉm"
                                    (focus)="picker.open()" (click)="picker.open()" (keydown.enter)="picker.open()" (keydown.arrowDown)="picker.open()" required/>
                                    <mat-datepicker #picker panelClass="kit-datepicker"></mat-datepicker>
                              </div>
                        </div>
                        <div class="form-row">
                              <!-- <label class="label" for="name">Ng∆∞·ªùi theo d√µi</label> -->
                              <kit-dropdown [options]="(userOptions | async) ?? []"  [multiple]="true" formControlName="followerIds" [placeholder]="'Th√™m ng∆∞·ªùi theo d√µi'" [multiple]="true"></kit-dropdown>
                        </div>
                        <div class="form-row form-input">
                              <textarea formControlName="description" placeholder="" noSpellcheck></textarea>
                              <label for="description">N·ªôi dung thanh to√°n</label>
                        </div>
                        <div class="form-row display-flex flex-column gap-5px">
                              <label class="label">T·ªáp ƒë√≠nh k√®m chi ph√≠ </label>
                              <kit-file-uploader [meta]="uploadMeta" [(uploads)]="uploads"></kit-file-uploader>
                        </div>
                  </div>
            </form>
      </ng-container>
</ng-template>

<!-- 3) Error -->
<ng-template #errorTpl>
      <kit-404-page title="‚õî Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu thanh to√°n" variant="404"></kit-404-page>
</ng-template>