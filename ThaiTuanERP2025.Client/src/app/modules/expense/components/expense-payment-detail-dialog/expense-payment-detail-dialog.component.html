<div class="dialog">
      <div class="dialog-container">
            <div class="dialog-heading">
                  <div class="dialog-title">
                        <h1>Chi ti·∫øt thanh to√°n</h1>
                  </div>
                  <div class="dialog-close">
                        <button type="button" class="close-button" (click)="close()" aria-label="ƒê√≥ng">
                              <span class="text material-icons-outlined">close</span>
                        </button>
                  </div>
            </div>
            <div class="dialog-body"  #dialogBody>
                  <ng-container *ngIf="loading(); else contentTpl">
                        <kit-loading-spinner></kit-loading-spinner>
                  </ng-container>
                  <ng-template #contentTpl >
                       <ng-container *ngIf="!err(); else errorTpl">
                              <div class="expense-payment-detail-container">
                                    <div class="payment-heading display-flex gap-10px align-items-center" [class.scrolled]="isScrolled">
                                          <div class="label-status" [@statusChangeFade]="paymentDetail?.status">
                                                <span class="label-status-badge" [ngClass]="(paymentDetail?.status | expensePaymentStatus).class">
                                                      {{ (paymentDetail?.status | expensePaymentStatus).text }}
                                                </span>
                                          </div>
                                          <h3 class="payment-name">{{ paymentDetail?.name }}</h3>
                                          <ng-container *ngIf="canApproveOrReject">
                                                <div class="payment-actions display-flex gap-10px align-items-center" >
                                                      <!-- <button type="button" class="button submit-button" (click)="onApprove()">Duy·ªát</button> -->
                                                      <kit-spinner-button type="button" cssClass="submit-button" [loading]="processing" [disabled]="loading()" text="Duy·ªát" loadingText="ƒêang duy·ªát‚Ä¶" (click)="onApprove()"></kit-spinner-button>
                                                      <kit-spinner-button type="button" cssClass="danger-button" [loading]="processing" [disabled]="loading()" text="T·ª´ ch·ªëi" loadingText="ƒêang t·ª´ ch·ªëi‚Ä¶" (click)="onReject()"></kit-spinner-button>
                                                      <!-- <button type="button" class="button danger-button" (click)="onReject()">T·ª´ ch·ªëi</button> -->
                                                </div>
                                                <ng-container *ngIf="currentStepSafe && isExpired(currentStepSafe)">
                                                      <div class="payment-expired-badge margin-left-auto">
                                                            <span class="badge danger-badge">Qu√° h·∫°n duy·ªát</span>
                                                      </div>
                                                </ng-container>
                                                <ng-container *ngIf="currentStepSafe as step">
                                                      <ng-container *ngIf="!isExpired(step)">
                                                            <div class="payment-due-time margin-left-auto">
                                                                  <kit-flip-countdown [timeLeft]="getSecondsRemaining(step)"></kit-flip-countdown>
                                                            </div>
                                                      </ng-container>
                                                </ng-container>
                                          </ng-container>
                                          <ng-container *ngIf="paymentDetail?.status === 6 || paymentDetail?.status === 7">
                                                <div class="payment-outgoing-btn margin-left-auto">
                                                      <button type="button" class="blue-button" (click)="navigateToOutgoingPaymentRequest()">
                                                            Ghi nh·∫≠n kho·∫£n ti·ªÅn ra
                                                      </button>
                                                </div>
                                          </ng-container>
                                    </div>
                                    <div class="payment-body margin-top-15px">
                                          <div class="general-information-block primary-card">
                                                <div class="card-header">Th√¥ng tin chung</div>
                                                <div class="card-body general-grid">
                                                      <div class="row">
                                                            <label>ID</label>
                                                            <div class="value mono">{{ paymentDetail?.subId }}</div>
                                                      </div>
                                                      <div class="row">
                                                            <label>T·∫°o b·ªüi</label>
                                                            <div class="value flex">
                                                                  <img class="avatar" [src]="paymentDetail?.createdByUser | avatarUrlPipe" alt="avatar">
                                                                  <span>{{ paymentDetail?.createdByUser?.fullName }}</span>
                                                            </div>
                                                      </div>
                                                      <div class="row">
                                                            <label>T·∫°o l√∫c</label>
                                                            <div class="value">{{ paymentDetail?.createdDate | date:'HH:mm dd/MM/yyyy' }}</div>
                                                      </div>
                                                      <div class="row">
                                                            <label>C√¥ng ty tr·∫£ cho</label>
                                                            <div class="value ellipsis" [title]="paymentDetail?.supplier?.name">
                                                                  {{ paymentDetail?.supplier?.name }}
                                                            </div>
                                                      </div>
                                                      <div class="row">
                                                            <label>N·ªôi dung thanh to√°n</label>
                                                            <div class="value ellipsis">
                                                                  {{ paymentDetail?.description }}
                                                            </div>
                                                      </div>
                                                      <div class="row">
                                                            <label>Lu·ªìng duy·ªát</label>
                                                            <div class="value">
                                                                  <ul class="avatar-stack">
                                                                        <li *ngFor="let step of (paymentDetail?.workflowInstanceDetail?.steps || []); let i = index; trackBy: trackByIndex">
                                                                               <img *ngIf="step.approvedByUser" class="avatar-user approver-avatar" [src]="step.approvedByUser | avatarUrlPipe" alt="approved by">
                                                                              <img *ngIf="step.rejectedByUser" class="avatar-user rejecter-avatar" [src]="step.rejectedByUser | avatarUrlPipe" alt="rejected by">
                                                                              <img *ngIf="!step.approvedByUser && !step.rejectedByUser && step.status === 'Waiting'" class="avatar-user waiting-avatar" [src]="step.defaultApproverUser | avatarUrlPipe" alt="{{ step.status }}">
                                                                        </li>
                                                                  </ul>
                                                            </div>
                                                      </div>
                                                      <div class="row">
                                                            <label>Ng∆∞·ªùi theo d√µi</label>
                                                            <div class="value">
                                                                  <ul class="avatar-stack">
                                                                        <li *ngFor="let f of (paymentDetail?.followers || []); trackBy: trackByIndex">
                                                                              <img class="avatar" [src]="f | avatarUrlPipe" alt="follower">
                                                                        </li>
                                                                  </ul>
                                                            </div>
                                                      </div>
                                                </div>
                                          </div>
                                          <div class="payment-amount-block primary-card margin-top-15px">
                                                <div class="card-body">
                                                      <div class="total-amount-block">
                                                            <div class="amount-infor-block">
                                                                  <label class="amount-infor-label" for="total-amount">S·ªë ti·ªÅn thanh to√°n</label>
                                                                  <span>{{ paymentDetail?.totalWithTax | number:'1.0-0' }} VNƒê</span>
                                                            </div>
                                                            <div class="amount-infor-block">
                                                                  <label class="amount-infor-label" for="payment-date">Ng√†y thanh to√°n</label>
                                                                  <span>{{ paymentDetail?.dueDate | date: 'dd/MM/yyyy' }}</span>
                                                            </div>
                                                            <div class="amount-infor-block">
                                                                  <label class="amount-infor-label" for="payment-date">S·ªë ti·ªÅn ƒë√£ t·∫°o l·ªánh</label>
                                                                  <span>{{ paymentDetail?.outgoingAmountPaid | number:'1.0-0' }} VNƒê</span>
                                                            </div>
                                                            <div class="amount-infor-block">
                                                                  <label class="amount-infor-label" for="payment-date">S·ªë ti·ªÅn ch·ªù t·∫°o l·ªánh</label>
                                                                  <span>{{ paymentDetail?.remainingOutgoingAmount | number:'1.0-0' }} VNƒê</span>
                                                            </div>
                                                      </div>
                                                      <div class="payment-tab-wrapper">
                                                            <div class="payment-tab-nav display-flex gap-5px border-bottom margin-bottom-10px">
                                                                  <button type="button" class="tab-button" [ngClass]="{ 'active': activeTab === 'items' }" (click)="setActiveTab('items')">
                                                                        B·∫£ng h·∫°ng m·ª•c
                                                                  </button>
                                                                  <button  type="button" class="tab-button" [ngClass]="{ 'active': activeTab === 'outgoings' }" (click)="setActiveTab('outgoings')">
                                                                        Kho·∫£n ti·ªÅn ra
                                                                  </button>
                                                            </div>
                                                            <ng-container [ngSwitch]="activeTab">
                                                                  <!-- Tab 1: H·∫°ng m·ª•c thanh to√°n -->
                                                                  <ng-container *ngSwitchCase="'items'">
                                                                        <div [@tabSwitchFade]>
                                                                              <div class="amount-item-block" >
                                                                                    <div class="payment-item-table margin-top-20px">
                                                                                          <table class="table table-center-text">
                                                                                                <thead>
                                                                                                      <tr>
                                                                                                            <th style="width: 1%;">#</th>
                                                                                                            <th>H·∫°ng m·ª•c</th>
                                                                                                            <th class="head-quanity" style="width: 7%;">S·ªë l∆∞·ª£ng</th>
                                                                                                            <th>ƒê∆°n gi√°</th>
                                                                                                            <th>Th√†nh ti·ªÅn</th>
                                                                                                            <th class="head-tax" style="width: 6%;">Thu·∫ø</th>
                                                                                                            <th>S·ªë ti·ªÅn thu·∫ø</th>
                                                                                                            <th>S·ªë ti·ªÅn c√≥ thu·∫ø</th>
                                                                                                            <th class="head-extension">Ng√¢n s√°ch</th>
                                                                                                            <th class="head-invoice">H√≥a ƒë∆°n</th>
                                                                                                      </tr>
                                                                                                </thead>
                                                                                                <tbody>
                                                                                                      <tr *ngFor="let item of paymentDetail?.items; let i = index">
                                                                                                            <td>{{ i + 1 }}</td>
                                                                                                            <td class="item-name">{{ item.itemName }}</td>
                                                                                                            <td class="item-quanity">{{ item.quantity | number:'1.0-0' }}</td>
                                                                                                            <td class="item-unit-price">{{ item.unitPrice | number:'1.0-0' }} VNƒê</td>
                                                                                                            <td class="item-amount">{{ item.amount | number:'1.0-0' }} VNƒê</td>
                                                                                                            <td class="item-tax">{{ (item.taxRate * 100) | number:'1.0-0' }}%</td>
                                                                                                            <td class="item-tax-amount">{{ item.taxAmount | number:'1.0-0' }} VNƒê</td>
                                                                                                            <td class="item-total-with-tax">{{ item.totalWithTax | number:'1.0-0' }} VNƒê</td>
                                                                                                            <td class="item-budget-code">{{ item.budgetCode?.code}} - {{ item.budgetCode?.name }}</td>
                                                                                                            <td class="item-invoice">
                                                                                                                  <button type="button" class="button" [ngClass]="item.invoice ? 'default-button' : 'cancel-button'">
                                                                                                                        {{ item.invoice ? 'Xem h√≥a ƒë∆°n' : 'Kh√¥ng h√≥a ƒë∆°n' }}
                                                                                                                  </button>
                                                                                                            </td>
                                                                                                      </tr>
                                                                                                </tbody>
                                                                                                <tfoot *ngIf="paymentDetail?.items?.length">
                                                                                                      <tr class="total-row">
                                                                                                            <td colspan="4" class=""><strong>T·ªïng</strong></td>
                                                                                                            <td>{{ paymentDetail?.totalAmount | number:'1.0-0' }} VNƒê</td>
                                                                                                            <td></td>
                                                                                                            <td>{{ paymentDetail?.totalTax | number:'1.0-0' }} VNƒê</td>
                                                                                                            <td>{{ paymentDetail?.totalWithTax | number:'1.0-0' }} VNƒê</td>
                                                                                                            <td colspan="4"></td>
                                                                                                      </tr>
                                                                                                </tfoot>
                                                                                          </table>
                                                                                    </div>
                                                                              </div>
                                                                        </div>
                                                                  </ng-container>

                                                                  <!-- Tab 2: Kho·∫£n ti·ªÅn ra -->
                                                                  <ng-container *ngSwitchCase="'outgoings'">
                                                                        <div class="" [@tabSwitchFade]>
                                                                              <div class="outgoing-payments-table">
                                                                                    <table class="table table-center-text">
                                                                                          <thead>
                                                                                                <tr>
                                                                                                      <th style="width: 1%;">#</th>
                                                                                                      <th>Kho·∫£n chi</th>
                                                                                                      <th>Tr·∫°ng th√°i</th>
                                                                                                      <th>Ng√†y ghi nh·∫≠n</th>
                                                                                                      <th>S·ªë ti·ªÅn ghi nh·∫≠n</th>
                                                                                                </tr>
                                                                                          </thead>
                                                                                          <tbody>
                                                                                                <tr *ngFor="let outgoing of paymentDetail?.outgoingPayments; let i = index">                                                                                                      
                                                                                                      <td>{{ i + 1 }}</td>
                                                                                                      <td>
                                                                                                            <div class="link">
                                                                                                                  <span>üîó</span>
                                                                                                                  <span (click)="openOutgoingPaymentDetailDialog(outgoing.id)">{{ outgoing.name }}</span>
                                                                                                            </div>
                                                                                                      </td>
                                                                                                      <td>
                                                                                                            <span  class="outgoing-status-badge" [ngClass]="outgoing.status | outgoingPaymentStatus : 'class'">
                                                                                                                  {{ outgoing.status | outgoingPaymentStatus : 'label' }}
                                                                                                            </span>
                                                                                                      </td>
                                                                                                      <td>{{ outgoing.postingDate | date: 'shortDate' }}</td>
                                                                                                      <td>{{ outgoing.outgoingAmount | number:'1.0-0' }} VNƒê</td>
                                                                                                </tr>
                                                                                          </tbody>
                                                                                    </table>
                                                                              </div>
                                                                        </div>
                                                                  </ng-container>
                                                            </ng-container>
                                                      </div>                                                      
                                                </div>
                                          </div>
                                    </div>
                              </div>
                       </ng-container>
                  </ng-template>
                   <ng-template #errorTpl>
                        <kit-404-page title="‚õî Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu thanh to√°n" variant="error"></kit-404-page>
                  </ng-template>
            </div>
            <div class="dialog-footer"></div>
      </div>
</div>